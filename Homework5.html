<!DOCTYPE html>
<html><head>
</head>
<body style="color: #494c4e;">
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Q1. Restaurant Address Cleanup (20 points)</span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Use the Restaurants.sql file from HW2, which creates three tables Restaurant, Reviewer, and Rating. In this problem, we are concerned with the Restaurant table, which has a single attribute 'Address' of type 'varchar2(100)'. We would like address to be searchable.&nbsp; So we would like to create another table Restaurant_Locations with the following attributes:</span></p>
<p style="margin: 0in 0in 0in 0.5in; text-indent: 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">rID, name, street_address,&nbsp; city, state, zipcode, cuisine </span></p>
<p style="margin: 0in 0in 0in 0.25in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">a. Create Restaurant_Locations table. Use the source dataset to determine the data types (and sizes) to use for each of the attributes.</span></p>
<p style="margin: 0in 0in 0in 0.25in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">b. Write a cursor (using SQL and PL/SQL) to process each row from the original Restaurant table, extracting information as necessary to populate the new Restaurant_Locations table. T</span><span style="font-size: 14.0pt;">he original address field must be split up and parsed into the new street_address, city, state, and zipcode fields.</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Submit 1.sql file. </span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">&nbsp;</span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Q2. Restaurant JDBC (15 points) </span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Create ZipCode table based on attributes in zipcode.csv file (</span><span style="font-size: 14.0pt;">zip, city, state, latitude, longitude, timezone, dst)</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Then download the CHIzipcode.csv file provided on D2L. </span></p>
<ol style="list-style-type: lower-alpha; margin-bottom: 0in; margin-top: 0px;">
<li style="margin: 0in 0in 0in 0px; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Write a </span><span style="font-size: 14.0pt;">Java program (similar to the one showed in class to connect to your Oracle database using JDBC driver) to</span><span style="font-size: 14.0pt;"> convert the zipcode.csv file into a series of SQL insert statements for ZipCode table.</span></li>
</ol>
<p style="margin: 0in 0in 0in 0.25in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">c. Use the program to join zipcodes table with restaurant_locations table and obtain latitude and longitude of all restaurants in the Restaurants table. </span></p>
<p style="margin: 0in 0in 0in 0.25in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Print out the name, zipcode, latitude, longitude using your program.</span></p>
<p style="margin: 0in 0in 0in 0.25in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Output should look like this:</span></p>
<p style="margin: 0in 0in 0in 0.25in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Shanghai Inn, 60625, "41.971614","-87.70256"</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Submit your zipcode.sql, zipcode.java and zipcode.class files</span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">&nbsp;</span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Q3.</span></b><span style="font-size: 14.0pt;"> <b>PL/SQL Functions</b> <b>(25 points)</b></span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">The restaurants in the database continue to be visited and reviewed. Information about new restaurant reviews is made available as:</span></p>
<p style="text-indent: 0.5in; margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">(RestaurantName, UserName, Rating, RatingDate) </span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Restaurant names and user names are assumed to be unique. </span><span style="font-size: 14.0pt;">Write a PL/SQL stored procedure that accepts the above input string and inserts new restaurant rating information into the Rating table. If a new user appears, it inserts into the Reviewer table. </span></p>
<p style="margin: 0in 0in 0in 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">&nbsp;</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Bonus(+5/+10):</span></b><span style="font-size: 14.0pt;"> Create a table ‘Top5Restaurants’ restaurants in the database as:</span></p>
<p style="margin: 0in 0in 0in 0.5in; text-indent: 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Create table Top5Restaurants(rID int) </span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Top5Restaurants holds the rIDs of top 5 restaurants in Chicago. Write a statement (+5) or row-level trigger(+10) on the Rating table that computes top 5 restaurants and populates the Top5Restaurants table. This trigger is fired every time a restaurant receives a new rating. Test your procedure and trigger in SQL Developer to insert the following four strings:</span></p>
<p style="margin: 0in 0in 0in 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">(‘Jade Court’,`Sarah M.’, 4, ‘08/17/2017’)</span></p>
<p style="margin: 0in 0in 0in 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">(‘Shanghai Terrace’,`Cameron J.’, 5, ‘08/17/2017’)</span></p>
<p style="margin: 0in 0in 0in 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">(‘Rangoli’,`Vivek T.’,3,`09/17/2017’)</span></p>
<p style="margin: 0in 0in 0in 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">(‘Shanghai Inn’,`Audrey M.’,2,`07/08/2017’);</span></p>
<p style="margin: 0in 0in 0in 0.5in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">(‘Cumin’,`Cameron J.’, 2, ‘09/17/2017’)</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">&nbsp;</span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Submit your 3.sql file and screenshot of data in Top5Restaurant table after the last inserted string in (c). </span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">&nbsp;</span></b></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Q4. Triggers. (15 points)</span></b></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Consider the TASK and CONTRACT tables defined by the following script, which also populates the JOB table:</span><span style="font-size: 14.0pt; font-family: 'MS Mincho';"> </span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">DROP TABLE CONTRACT CASCADE CONSTRAINTS; </span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">DROP TABLE TASK CASCADE CONSTRAINTS; </span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">&nbsp;</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">CREATE TABLE TASK (</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">TaskID CHAR(3),</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">TaskName VARCHAR(20),</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">ContractCount NUMERIC(1,0) DEFAULT 0, </span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">CONSTRAINT PK_TASK PRIMARY KEY (TaskID)</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">);</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">&nbsp;</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">CREATE TABLE CONTRACT </span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">(</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">TaskID CHAR(3),</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">WorkerID CHAR(7),</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">Payment NUMERIC(6,2),</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">CONSTRAINT PK_CONTRACT PRIMARY KEY (TaskID, WorkerID),</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">CONSTRAINT FK_CONTRACTTASK FOREIGN KEY (TaskID) REFERENCES TASK (TaskID) </span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">);</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">&nbsp;</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">INSERT INTO TASK (TaskID, TaskName) VALUES ('333', 'Security' );</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">INSERT INTO TASK (TaskID, TaskName) VALUES ('322', 'Infrastructure');</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">INSERT INTO TASK (TaskID, TaskName) VALUES ('896', 'Compliance' );</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">&nbsp;</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">SELECT * FROM TASK;</span></p>
<p style="margin: 0in; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-family: 'Courier New';">COMMIT; </span></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">The ContractCount attribute of TASK should store a count of how many workers have signed contracts to work on that task, that is, the number of records in CONTRACT with that TaskID, and its value should never exceed 3. Your task is to write three triggers that will maintain the </span></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">value of the ContractCount attribute in TASK as changes are made to the CONTRACT table. Write a script file Problem2.sql containing definitions of the following three triggers: </span></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">1. The first trigger, named NewContract, will fire when a user attempts to INSERT a row into CONTRACT. This trigger will check the value of ContractCount for the corresponding task. If ContractCount is less than 3, then there is still room in the task for another worker, so it will allow the INSERT to occur and will increase the value of ContractCount by one. If ContractCount is equal to 3, then the task is full, so it will cancel the INSERT and display an error message stating that the task is full. </span></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">2. The second trigger, named EndContract, will fire when a user attempts to DELETE one or more rows from CONTRACT. This trigger will update the values of ContractCount for any affected tasks to make sure they are accurate after the rows are deleted, by decreasing the value of ContractCount by one each time a worker is removed from a task. </span></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">3. The third trigger, named NoChanges, will fire when a user attempts to UPDATE one or more rows of CONTRACT. The trigger will cancel the UPDATE and display an error message stating that no updates are permitted to existing rows of CONTRACT. </span></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">NewContract and EndContract should be row-level triggers; NoChanges should be a statement-level trigger. </span></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><span style="font-size: 14.0pt;">Run the script to define your triggers and test them to make sure they work by doing a few INSERTS, DELETES, and UPDATES on the CONTRACT table. </span></p>
<p style="margin: 0in 0in 12pt; font-size: 12pt; font-family: 'Times New Roman', serif;"><b><span style="font-size: 14.0pt;">Submit one 4.sql file with the trigger code and your insert, delete and update statements. </span></b></p>
</body></html>